\documentclass[12pt]{article}
\usepackage{sbc-template}

\usepackage[latin1]{inputenc}
\usepackage[brazil]{babel}
\usepackage{graphicx,url}
\usepackage{listings,acronym}
\usepackage{amssymb,amsmath,amsfonts}
\usepackage{ctable,tabularx}
\usepackage{paralist,enumerate}
\usepackage{balance}
\usepackage[portuguese,ruled,lined,linesnumbered]{algorithm2e}
%\usepackage{algorithmic,algorithm}

\newacro{FD}{Fusão de Dados}
\newacro{STR}[STR]{Sistema de Tempo Real}
\newacro{RSSF}[RSSF]{Rede de Sensores sem Fio}
\newacro{RSSFs}{Redes de Sensores sem Fio}
\newacro{WSN}{Wireless Sensor Network}
\newacro{KiBaM}[KiBaM]{Kinect Battery Model}

\hyphenation{propi-cia-do espa-lhados esca-lonamento moni-torar ou-tros mo-de-lar rea-li-za monito-ra-men-to}

\sloppy

\title{Escalonamento de Sono e Efeito Recuperação em Baterias de Nodos em Redes de Sensores sem Fio}

\author{Leonardo M. Rodrigues\inst{1}, Carlos B. Montez\inst{1}, Paulo Portugal\inst{2}, Francisco Vasques\inst{2}}

\address{
	Programa de Pós-Graduação em Engenharia de Automação e Sistemas (PPGEAS)\\
	Universidade Federal de Santa Catarina (UFSC) -- Florianópolis, SC -- Brasil
\nextinstitute
	Faculdade de Engenharia da Universidade do Porto (FEUP)\\
	Porto -- Portugal
\email
     l.m.rodrigues@posgrad.ufsc.br, carlos.montez@ufsc.br,
     pportugal@fe.up.br, vasques@up.pt
}

\begin{document}
\maketitle


% acho que não é necessário um abstract
%\begin{abstract}
%We present a study on the energy issue in \ac{WSN} nodes. Thus, we cover basics about batteries, battery models and the
% importance of task scheduling in the nodes. Simulations are used to show the importance of the recovery effect,
%intrinsic in batteries, to increase the lifetime of the network. Finally, we evaluate the results achieved in the simulations.
%\end{abstract}

\begin{resumo} 
Neste artigo é apresentado um estudo sobre a questão energética em nodos de uma \ac{RSSF}.
São abordados alguns modelos de bateria utilizados em simuladores para representar o comportamento
de uma bateria ao longo do tempo, conforme o consumo energético imposto pelos nodos.
A importância do escalonamento de tarefas nos nodos (escalonamento do sono) também é discutida,
assim como o chamado efeito recuperação das baterias.
Resultados de simulações são usados para demonstrar a importância do escalonamento na execução de atividades em cada nodo, refletindo no aumento do tempo de vida da rede.
\end{resumo}

\section{Introdução} \label{sec:introducao}
% [ v ] Apresentar o tema RSSF.
% [ v ] Comentar a importância da economia de energia nos nodos.
% [ v ] Comentar sobre o tradeoff entre desempenho e tempo de vida.
% 		Apresentar tópicos:
% [ v ] - Modelos de Bateria: citar a existência de dois modelos analíticos.
% [ v ] - Técnicas de escalonamento: citar sua importância no tempo de vida da bateria.
% [ v ] - Fusão de Dados: citar importância sobre a não sobrecarga da rede (troca de mensagens).
% [ v ] Indicar particionamento das seções do artigo.

O desenvolvimento, seguido pela evolução e redução nos preços, de nodos sensores tem levado à uma popularização das Redes de Sensores sem Fio (RSSF).
Esses nodos -- com capacidade de processamento, comunicação e sensoriamento de grandezas do ambiente
(ex. temperatura, umidade, som, pressão atmosférica) -- têm propiciado o emprego de \ac{RSSF} nos mais diversos domínios de
aplicação \cite{Buratti2009}.
Originalmente, uma Rede de Sensores sem Fio era definida como aquela formada por um grande número de nodos,
espalhados de forma aleatória e com capacidades de auto-gerenciamento \cite{akyildiz2:2002}.
Atualmente, encontra-se esse tipo de rede empregado em um escopo muito mais amplo, desde aplicações em ambientes
industriais \cite{Gungor2009} - onde muitas vezes há um número limitado de nodos os quais são cuidadosamente implantados - até em aplicações da agropecuária \cite{aqeel:2011} - onde é possível a existência de milhares de nodos, alguns com mobilidade.

Independente do domínio de aplicação, em comum a todos os tipos de \ac{RSSF}, existe o conceito de ``esforço colaborativo'' entre
os nodos, no sentido de monitorar as grandezas do ambiente. A ideia básica é que a confiança no monitoramento seja baseada em um grupo
de sensores, de baixo custo, em vez de se basear em sensores individuais.
Ademais, geralmente há uma redundância no número de nodos implantados, de forma que nem todos necessitam monitorar
a mesma grandeza física simultaneamente.
Outra característica importante nas \ac{RSSF} é a necessidade de economia energética.
O uso de baterias nos nodos implica na preocupação de se manter a rede operacional o maior tempo possível.
Isso é decorrente do fato da substituição de baterias, quando ocorrerem seus esgotamentos,
poder ser uma tarefa inviável ou ter um custo financeiro proibitivo, 
quando a rede, por exemplo, for implantada em locais inóspitos ou tiver grande número de nodos.

A redundância em RSSF e a necessidade de se estender o tempo de vida da rede implicam no estabelecimento de
políticas para se efetuar rodízio na utilização dos nodos de forma eficaz.
Quando a voltagem da bateria atinge um determinado nível, conhecido como \emph{cutoff}, as reações eletroquímicas internas deixam de acontecer,
indicando que a mesma está descarregada.
Alguns nodos cujas baterias estejam próximas aos seus estados de \emph{cutoff} podem ser encarregados de executar tarefas que
consumam menos energia, podendo até mesmo entrar em regimes ociosos (\textit{sleep mode}) enquanto outros nodos,
com maior capacidade atual em suas baterias, assumem as tarefas de monitoramento e processamento local na rede.

As técnicas que realizam alternância na execução dos nodos muitas vezes são denominadas de escalonamento do sono
(\textit{sleep scheduling})~\cite{Jurdak2010}.
Contudo, muitos dos trabalhos sobre este assunto são baseados em simulações nas quais assume-se
que as baterias dos nodos têm comportamento simples, muitas vezes, lineares. Esse tipo de suposição pode afetar os resultados obtidos
pelas simulações, pois as baterias possuem comportamentos bem mais complexos e difíceis de se modelar.
		
No contexto de modelagem de baterias, algumas pesquisas apontam soluções para estimar o tempo de vida de baterias sob diversos tipos de cargas \cite{panigrahi:2001, rakhmatov:2002, jongerden:2008, kerasiotis:2010, nguyen:2011}.
Em comum a esses trabalhos, a preocupação em definir modelos que representem os efeitos da Taxa de Capacidade 
(\textit{Rate Capacity Effect}) e o de Recuperação (\textit{Recovery Effect}), inerentes às baterias.

De uma forma simplificada, o Efeito Taxa de Capacidade representa o comportamento não-linear da bateria quando submetida à diferentes descargas de corrente; enquanto o Efeito Recuperação representa a habilidade da bateria em se recuperar quando está ociosa ou
submetida à cargas baixas. Estudos na literatura~\cite{rakhmatov:2002, li:2013} apontam a existência de diferenças nos tempos de
vida das baterias, decorrentes desses efeitos, conforme a ordem escolhida pelos nodos na execução de suas tarefas.
Neste artigo é investigado, no contexto das \ac{RSSF}, o tempo de vida dos nodos, conforme a escolha
das atividades de transmissão e recepção de dados, além de atividades de processamento.
O objetivo é mostrar os efeitos da Taxa de Capacidade e Recuperação nas baterias sob o ponto de vista do escalonamento de sono dos nodos da rede.

Este artigo está organizado da seguinte forma. A Seção~\ref{sec:embasamento} trata sobre os conceitos básicos envolvidos neste trabalho. A Seção~\ref{sec:algoritmos} mostra algumas definições com relação ao modelo utilizado. A Seção~\ref{sec:simulacoes} apresenta as simulações realizadas, bem como alguns resultados preliminares obtidos neste trabalho. Na Seção~\ref{sec:conclusao}, apresentam-se as considerações finais sobre os assuntos discutidos neste artigo.

%************************************************
%************************************************
\section{Fundamentação Teórica} \label{sec:embasamento}

Esta seção tem como objetivo abordar alguns conceitos importantes que estão diretamente ligados ao conteúdo deste artigo.
Inicialmente, abordam-se as questões básicas sobre baterias, tal como funcionamento e características físicas.
Em seguida, são vistos os conceitos sobre modelos de baterias conhecidos na literatura.
Por fim, é feita uma revisão sobre escalonamento de tarefas em nodos.

\subsection{Conceitos sobre Baterias} \label{ssec:baterias}

% [ v ] Principais tecnologias.
% [ v ] Como funciona quimicamente o descarregamento.
% [ v ] Comentar sobre tipos de Modelos de Bateria.
% [ v ] Influência do tipo descarga: Rate Capacity e Recovery Effect.	

As baterias são fundamentais nos dias de hoje, sem as quais, o conceito de mobilidade não existiria. 
Basicamente, baterias são dispositivos que contêm uma ou mais células eletroquímicas capazes de transformar
energia química em energia elétrica.
As células são formadas por dois terminais (eletrodos): o positivo (ou \emph{cátodo}) e o negativo (ou \emph{ânodo}).
Um eletrólito permite o fluxo de íons entre os terminais da bateria.
	
\begin{figure}[ht]
	\centering
	\includegraphics[width=.4\textwidth]{images/battery.pdf}
	\caption{Modo de funcionamento de uma bateria.}
	\label{fig:battery}
\end{figure}
	
De forma geral, ao descarregar uma bateria, ocorre a oxidação do ânodo, gerando elétrons (que fluem pelo circuito externo) e
íons carregados positivamente (que, por difusão, movem-se pelo eletrólito em direção ao cátodo).
Reações de redução ocorrem no cátodo, gerando íons carregados negativamente. A Figura~\ref{fig:battery} ilustra o funcionamento
de uma bateria simples.
	
Além disso, cada bateria tem duas características próprias: $V_{OC}$ é a voltagem em circuito aberto,
ou seja, a carga total armazenada na bateria sem a presença de nenhuma corrente de descarga; e $V_{cut}$ é o limite que indica
quando a bateria está descarregada.
Dois parâmetros importantes são a \emph{capacidade teórica}, que especifica qual a
quantidade de carga máxima que uma bateria suporta, e a \emph{capacidade atual}, que estabelece a
quantidade de energia que uma bateria entrega sob uma determinada carga~\cite{lahiri:2002}.
	
Existem diversos tipos de tecnologias de baterias recarregáveis: Ni-Cd (Níquel-Cádmio), Ni-MH (Níquel-Hidreto Metálico),
Li-ion (Íons de Lítio), Li-polymer (Lítio-polímero). A tecnologia \textit{Ni-Cd} foi amplamente utilizada em diversos dispositivos
eletrônicos (celulares e \emph{laptops}, principalmente) devido ao seu baixo custo, entretanto, perdeu espaço devido à baixa capacidade de carga e ao ``efeito memória\footnote{Diminuição da capacidade de carga com o passar do tempo.}''.
A tecnologia \textit{Ni-MH} tem densidade de energia duas vezes maior que a tecnologia Ni-Cd, porém, tem menor ciclo de vida,
é mais cara e ineficiente com altas taxas de descarga.
A bateria \textit{Li-ion} é uma das mais utilizadas na atualidade, contando com maior densidade de energia e ciclo de
vida cerca de duas vezes maior que as baterias Ni-MH.
Por outro lado, tem maior sensibilidade a correntes de descarga e é mais cara que a tecnologia Ni-MH.
Por fim, as baterias \textit{Li-polymer} são tão eficientes quanto a tecnologia Li-ion e ainda possuem um invólucro flexível,
o que as tornam adequadas para uso em dispositivos móveis com tamanho e peso reduzidos~\cite{lahiri:2002}.
	
\subsubsection{Efeitos intrínsecos} \label{sssec:efeitos}

Existem dois efeitos que estão presentes em qualquer bateria, independentemente da tecnologia utilizada: Efeito da Taxa de Capacidade
(\emph{Rate Capacity Effect}) e Efeito Recuperação (\emph{Recovery Effect}).
Tais efeitos são muito importantes para o tempo de vida e a capacidade de uma bateria.

\begin{itemize}
	\item \textbf{Efeito Taxa de Capacidade}: está relacionado à dependência entre a capacidade atual da bateria e a magnitude da corrente de descarga. Neste caso, ao aplicar altas correntes de descarga, a capacidade da bateria é significativamente reduzida.
	
	\item \textbf{Efeito Recuperação}: refere-se à habilidade que as baterias têm de recuperar parte de sua capacidade nos intervalos que deixa de receber cargas (correntes) externas. Dessa forma, indica-se que sejam inseridos períodos ociosos entre as cargas para que a bateria tenha um maior tempo de vida~\cite{li:2013}.
\end{itemize}


\subsection{Modelos de Baterias} \label{ssec:modelos}
% [ v ] Comentar sobre a importância da bateria em RSSF.
% [ v ] Explicar o que são e para que servem os Modelos de Bateria.
% [ v ] Comentar sobre tipos de Modelos de Bateria.
% [ v ] Citar a existência de modelos analíticos e por que são melhores (consideram efeitos naturais da bateria).
% [ v ] Mostrar equações e comentar sobre variáveis nelas encontradas.
% [ v ] Mostrar um gráfico comparativo.

As questões energéticas são de extrema importância no contexto das \ac{RSSF}, uma vez que o tempo de vida da rede
depende das baterias individuais dos nodos que dela participam.
É desejável que cada nodo maximize seu tempo de vida, podendo contribuir com a rede pelo maior período possível.
Em um exemplo simples, onde um conjunto de nodos realiza o sensoriamento de uma determinada área, a falha de um nodo, por ter
a sua bateria exaurida, pode enfraquecer a precisão dos dados coletados naquela área específica.
Isso prejudica a cobertura espacial da rede, tornando a captura de dados presente em apenas alguns locais e inexistente em outros.
Dessa forma, o estudo de técnicas que permitam o aumento no tempo de vida de baterias é contínuo,
reforçando a busca por novas tecnologias, algoritmos mais eficientes e modelos de bateria mais precisos.

% Existem outros modelos conhecidos (ex.: Estocásticos), porém, não são revisados neste artigo.

\subsubsection{Modelos de Bateria Analíticos} \label{sssec:analiticos}

Os modelos de bateria analíticos são fundamentações matemáticas baseadas em equações que buscam considerar as características
físicas das baterias. Servem para estimar, conforme a carga aplicada, o tempo de vida das baterias.
Esses modelos descrevem a bateria de forma abstrata, porém, suas propriedades são modeladas utilizando apenas
algumas equações~\cite{jongerden:2008-2}.
Por envolverem a avaliação de expressões analíticas, tornam-se computacionalmente flexíveis~\cite{schneider:2011}.
Ou seja, é possível utilizar correntes como uma função de carga constante ou variável, ou alterar o tipo de bateria.
Além disso, podem modelar os efeitos eletroquímicos inerentes às baterias, tais como o Efeito Recuperação e o Efeito da Taxa de Capacidade.
		
O modelo mais simples é a \emph{Lei de Peukert}.
Ele considera parte dos efeitos não lineares, relacionando o tempo de vida da bateria com a taxa de descarga.
Porém, o Efeito Recuperação não faz parte do modelo. Assim, os resultados obtidos com a Lei de Peukert são considerados bons
apenas para cargas contínuas constantes, sendo inadequado quando cargas variáveis ou interruptas são usadas~\cite{jongerden:2008-2}.
		
Em~\cite{rakhmatov:2002-2}, os autores introduzem um novo modelo que descreve o processo de difusão do material ativo na bateria.
Esse modelo permite estimar o tempo de vida da bateria, com uma boa aproximação, para uma dada corrente de descarga utilizando
os dez primeiros termos de uma soma infinita.
		
\begin{figure}[ht]
  \centering
  \includegraphics[width=.45\textwidth]{images/kibam-model.pdf}
  \caption{\ac{KiBaM}~\cite{manwell:1993}.}
  \label{fig:kibam-model}
\end{figure}
		
Outro modelo analítico é o \ac{KiBaM}~\cite{manwell:1993}.
Este modelo abstrato é bastante intuitivo, sendo composto por dois tanques onde a carga da bateria é distribuída,
conforme ilustra a Fig.~\ref{fig:kibam-model}.
O tanque \emph{Carga Disponível} fornece energia ao dispositivo ligado diretamente à bateria.
Já o tanque \emph{Carga Limite} fornece carga ao tanque Carga Disponível.
Entretanto, a taxa a qual ocorre a transferência de carga depende da diferença entre as alturas das cargas nos
dois tanques ($h_1$ e $h_2$), além do parâmetro $k$.
O parâmetro $c$ indica uma fração da carga total (inserida no tanque Carga Disponível) encontrada na bateria~\cite{jongerden:2008-2}.
		
Ao consumir uma corrente $I$, a bateria reduz sua carga disponível, aumentando a diferença entre as alturas nos dois tanques.
Caso o consumo da corrente seja interrompido, inicia-se o fluxo de carga entre o tanque Carga Limite e Carga Disponível
até que a altura $h_1$ seja novamente igual à altura $h_2$.
Assim, durante um período ocioso, a bateria pode aumentar sua capacidade e, consequentemente, manter-se ativa por mais tempo. O fluxo entre os tubos é dado pelo sistema de equações diferenciais mostrado na Equação~\ref{eq:kibam-diferencial-equation}.
\small
	\begin{equation}
	\begin{cases}
		\frac{di}{dt} = - I + k(h_2 - h_1), \\
		\frac{dj}{dt} = - k(h_2 - h_1),
	\end{cases}
	\label{eq:kibam-diferencial-equation}
	\end{equation}
\normalsize
tendo como condições iniciais: $i(0) = c \cdot C$ e $j(0) = (1 - c) \cdot C$, onde $C$ representa a capacidade total da bateria.
Além disso, $h_1 = i/c$ e $h_2 = j/(1 - c)$. Tal sistema de equações pode ser resolvido utilizando transformadas de
Laplace~\cite{jongerden:2008}.
A Equação~\ref{eq:kibam-equation} mostra como calcular a quantidade de carga nos dois tanques.
\small
\begin{equation}
	\begin{cases}
		i = i_0e^{-k't} + \frac{(y_0k'c-I)(1-e^{-k't})}{k'} - \frac{Ic(k't-1+e^{-k't})}{k'} \\
		j = j_0e^{-k't} + y_0(1-c)(1-e^{-k't}) - \frac{I(1-c)(k't-1+e^{-k't})}{k'},
	\end{cases}
	\label{eq:kibam-equation}
\end{equation}
\normalsize
onde $k'$ é definido como:
\small
\begin{equation*}
	k' = \frac{k}{c(1-c)},
\end{equation*}
\normalsize
sendo $i_0$ e $j_0$, respectivamente, as quantidades de Carga Disponível e Limite nos tanques, no tempo $t=0$. Para $y_0$ (carga total), tem-se: $y_0 = i_0 + j_0$. O \ac{KiBaM} foi desenvolvido para modelar baterias Ácido-Chumbo. Segundo~\cite{jongerden:2008-2}, tal modelo não é adequado para baterias modernas utilizadas em dispositivos móveis, como as baterias Li-ion. Por outro lado, se o interesse recai apenas no tempo de vida da bateria, o \ac{KiBaM} pode ser utilizado, uma vez que descreve adequadamente tanto o Efeito da Taxa de Capacidade quanto o Efeito Recuperação.

		
\subsubsection{Modelos de Bateria Estocásticos} \label{sssec:estocasticos}

Segundo~\cite{jongerden:2008-2}, os primeiros modelos de bateria estocásticos foram desenvolvidos por Chiasserini e Rao, entre 1999 e 2001.
Tais modelos são baseados em Cadeias de Markov com Tempo Discreto e produzem uma boa descrição qualitativa
do comportamento da bateria sob pulsos de descarga.
Entretanto, o modelo proposto por Chiasserini considera apenas o Efeito Recuperação, não conseguindo lidar com perfis de carga
arbitrários com descargas de corrente variável (Efeito da Taxa de Capacidade).
		
Em 2005, \cite{rao:2005} propôs um modelo de bateria, também utilizando Cadeias de Markov, baseado no modelo
analítico \ac{KiBaM}~\cite{manwell:1993}.
No entanto, a formulação foi alterada para baterias Ni-MH, comumente utilizadas em nodos de uma \ac{RSSF}.
Os resultados experimentais deste modelo indicam que o tempo de vida da bateria de Ni-MH depende da frequência da carga aplicada,
o que não ocorre no \ac{KiBaM} original (para escalas de tempo menores que 30 minutos).
A solução envolve fazer com que a probabilidade de recuperar capacidade durante períodos ociosos dependa do tamanho do período~\cite{jongerden:2008-2}.
		
\subsection{Técnicas de Escalonamento} \label{sssec:escalonamento}

% [ v ] Comentar que o escalonamento do sono ajuda no tempo de vida.
% [ v ] Mostrar maneiras de escalonar as tarefas (conforme carga exigida).
% [ v ] Comentar sobre a inserção de períodos ociosos entre tarefas.
% [ v ] Mostrar gráfico com resultados de simulações.
Escolher a ordem na qual as tarefas\footnote{O termo \emph{tarefa} se refere a qualquer atividade do nodo que necessite de carga da bateria.}
devem ser realizadas em um nodo influencia a taxa de descarga da sua bateria, pois a submete à diferentes correntes,
ativando os seus efeitos inerentes, tais como  o Efeito Recuperação e o Efeito da Taxa de Capacidade.
Algumas tarefas consomem mais energia que outras, exigindo mais corrente ou levando mais tempo para concluir.
A escolha da ordem de execução das tarefas é chamada de \textit{escalonamento de tarefas} ou
\textit{escalonamento do sono}.

Apesar das pesquisas no escalonamento de tarefas já terem bem mais do que uma década,
um desafio que ainda necessita ser superado é o de como escolher a ordem de execução das tarefas de forma que o tempo de vida
das baterias seja maximizado~\cite{panigrahi:2001, rakhmatov:2002, nguyen:2011, li:2013}.

Em~\cite{rakhmatov:2002}, apresenta-se um exemplo demonstrando o impacto do sequenciamento de tarefas para a bateria do nodo.
Uma conclusão desse trabalho é que o tempo de vida da bateria é maximizado quando as tarefas são escolhidas de forma que
haja um decrescimento nas cargas de corrente das tarefas.
Ou seja, enquanto a bateria tem mais carga, as tarefas do nodo que consomem mais
carga são escolhidas primeiro. À medida que a capacidade da bateria do nodo é reduzida, as tarefas que consomem menos carga são
as escolhidas para executar.

Em~\cite{li:2013}, apresenta-se a formulação do problema através de um simples exemplo para transmissão de pacotes em aplicações
de tempo real brandas (\textit{soft real-time}).
Além disso, esse trabalho propõe um algoritmo de otimização local ciente de bateria que insere períodos ociosos entre tarefas
adjacentes, tirando proveito do Efeito Recuperação.
Com isso, o objetivo é minimizar o consumo de carga total do sistema.


%************************************************
%************************************************
\section{Modelo} \label{sec:algoritmos}
% [ v ] Comentar sobre o modelo utilizado.
% [ - ] Comentar sobre a linguagem de programação.
% [ v ] Mostrar o pseudo-algoritmo do KiBaM.
% [   ] Mostrar o pseudo-algotirmo do que é realizado nas simulações.

Esta seção apresenta o modelo de bateria utilizado nas simulações. Com relação ao ambiente de simulação, utiliza-se o GNU Octave \cite{octave:2014}. Por se tratar de uma linguagem interpretada de alto nível, bem estabelecida e voltada para cálculo numérico, a implementação de modelos matemáticos é facilitada.

Como visto na Seção~\ref{ssec:modelos}, existem diversos modelos de bateria, cada um com suas características.
O objetivo deste trabalho é observar o aumento no tempo de vida de uma \ac{RSSF} quando o Efeito Recuperação faz parte da rotina dos nodos nesta rede.
Além disso, deseja-se simular adequadamente o Efeito da Taxa de Capacidade quando diferentes cargas são aplicadas nas baterias dos nodos da rede.
		
Diante desses motivos, um dos modelos de bateria que se encaixa no perfil descrito é o \ac{KiBaM}.
Tal modelo aborda com certa simplicidade e grande abstração os conceitos característicos de uma bateria através da Equação~\ref{eq:kibam-equation}.
Utiliza-se uma função, denominada \emph{kibam}, que é chamada sempre que um nodo necessita executar uma tarefa (ou um conjunto de tarefas). O Algoritmo~\ref{alg:kibam} descreve de forma simplificada o funcionamento da função.
		
\begin{algorithm}[ht]
	\footnotesize
	\caption{Função KiBaM}
	\label{alg:kibam}
	\Entrada{y0, i0, j0, I, timeInit, period}
	\Saida{y0}
\Inicio{
	initializeConstantsAndVariables()\;
	\Enqto{t $\leq$ (timeInit + period)}{
		compute-i(y0, i0, j0, I, t)\; \label{alg:linhai}
		compute-j(y0, i0, j0, I, t)\; \label{alg:linhaj}
		saveOutput(i, j, t)\;         \label{alg:saveout}
	}
	updateVariables();
}
\end{algorithm}
		
De acordo com o Algoritmo~\ref{alg:kibam}, a função \ac{KiBaM} tem parâmetros relacionados ao nodo que lhe invoca. Com isso, é possível definir a capacidade atual da bateria do nodo, sua tarefa e seus períodos de funcionamento. Neste caso, $y0$ é a capacidade teórica da bateria, $i0$ é a quantidade de carga no tubo Carga Disponível, $j0$ é a quantidade de carga no tubo Carga Limite, $I$ é a corrente aplicada pela tarefa, $timeInit$ é o tempo de início da simulação e $period$ é o tempo de execução da tarefa.

O núcleo dessa função está no cálculo do conteúdo dos tubos Carga disponível (i) e Carga Limite (j)
(linhas~\ref{alg:linhai} e~\ref{alg:linhaj}, respectivamente).
Para isso, utilizam-se as definições encontradas na Equação~\ref{eq:kibam-equation}.
Por fim, o estado de cada tubo da bateria é salvo em um arquivo à parte para análises e geração de gráficos (linha~\ref{alg:saveout}).
		

%************************************************
%************************************************
\section{Resultados} \label{sec:simulacoes}

% [ v ] Explicar como funciona a simulação.
% [ v ] Comentar sobre a simulação sem e com o efeito recuperação.
% [ v ] Mostrar figuras e comentar sobre as 'curvas'.
% [ v ] Avaliar resultados obtidos.
% [ v ] Apresentar algumas comparações entre os dois modelos simulados.
% [ v ] Comentar sobre ganho percentual no tempo de vida dos nodos (rede).

Esta seção visa apresentar as simulações realizadas e os resultados preliminares desta pesquisa. O objetivo das simulações é fazer que o nodo execute até que a carga em sua bateria seja esgotada (ou alcance um valor mínimo predeterminado, \emph{cutoff}).
%Para isso, considera-se que o nodo tem conhecimento da carga existente em sua bateria.
O nodo é alimentado por uma bateria com capacidade teórica de $1000~mAh$ (ou $3600~As$) e conta com um conjunto de tarefas para executar, bem como seus respectivos tempos de execução.
		
\begin{table}[ht]
	\caption{Cargas utilizadas nas simulações.}
	\label{tab:cargas}
	\centering
	\footnotesize{
	\begin{tabular}{p{1.5cm}p{2.0cm}p{3.8cm}}
		\toprule
		\textbf{Tarefa}	& \textbf{Carga (mA)}	& \textbf{Tempo de execução (min)}	\\ \toprule
		$A$		& $40$				& $10$		\\
		$B$		& $20$				& $5$		\\
		$C$		& $5$				& $0-20$	\\ \bottomrule
	\end{tabular}
	}
\end{table}
		
O conjunto de tarefas utilizadas em todas as simulações é composto por três tarefas (Tabela~\ref{tab:cargas}).
A primeira, denominada de $A$, tem consumo de $40~mA$ e executa por $10~min$.
A segunda, $B$, consome $20~mA$ e tem tempo de execução igual a $5~min$.
Por fim, a terceira, $C$, consome $5~mA$ e é executada por tempos variando entre $0-20~min$, de acordo com a simulação.

Sob o ponto de vista do nodo, tais tarefas equivalem, por exemplo, à uma aplicação de monitoramento ambiental. Neste contexto, a Tarefa $A$ representa o processamento contínuo por um determinado tempo ($10~min$) realizado por um nodo, correspondendo a uma leitura de sensor, um pequeno processamento local e transmissão do resultado para outro nodo.
A Tarefa $B$ equivale ao período que o rádio receptor fica ligado à espera de novas comunicações de outro nodo.
Finalmente, a Tarefa $C$ representa um período ocioso (\emph{sleep mode}) que o nodo tem para fazer valer o Efeito Recuperação em sua bateria.

		
A função \ac{KiBaM} é usada para calcular a quantidade de carga consumida na bateria quando o nodo executa sua tarefa atual.
Assim, a capacidade da bateria é reduzida conforme a carga (corrente) aplicada ao realizar uma tarefa (Efeito da Taxa de Capacidade).
Caso o nodo entre no \emph{sleep mode}, o \ac{KiBaM} é responsável por modelar o ganho de capacidade na bateria do nodo (Efeito Recuperação). Utilizam-se os seguintes valores para as constantes da Equação 2: $k = 10^{-5}$ e $c = 0,625$.

Os resultados das simulações são mostrados em gráficos que descrevem a descarga no tubo Carga Disponível do nodo.
Quatro cenários de uso são empregados para ilustrar diferentes situações de execução das tarefas do(s) nodo(s).
		
		
		
% 2. Cenário 1: Nodos sem Efeito Recuperação X Nodo com Efeito Recuperação.
	% Situação 1: Nodo sem Efeito Recuperação.
	% Situação 2: Nodo com Efeito Recuperação em determinado intervalo.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=.63\textwidth]{images/simulacao0/simulation0(edited).pdf}
	\caption{Cenário 1: Nodo sem \emph{sleep mode} (Situação 1).\newline
	\hspace*{3.4cm}Nodo com \emph{sleep mode} de 8~horas (Situação 2).}
	\label{fig:simulacao0}
\end{figure}

\subsection{Cenário 1}
O Cenário 1 é usado para ilustrar a diferença nos tempos de execução com e sem Efeito Recuperação.
Com isso, consideram-se duas situações.
A \emph{Situação 1} investiga o funcionamento do nodo sem utilizar o \emph{sleep mode} até que sua bateria alcance o nível de \emph{cutoff}.
Neste caso, o nodo executa apenas a tarefa $A$.
Na \emph{Situação 2}, o nodo opera normalmente (tal qual a \emph{Situação 1}) até o momento que entra em \emph{sleep mode} (em $t = 850$, aproximadamente).
Neste momento, o nodo passa a executar a tarefa $C$, tirando proveito do Efeito Recuperação por um determinado tempo ($8~horas$) e,
então, retorna à atividade realizada anteriormente, isto é, execução da tarefa $A$.
		
Na Figura~\ref{fig:simulacao0}, ao entrar em \emph{sleep mode} (\emph{Situação 2}), a bateria do nodo tem maior tempo de vida.
Na \emph{Situação 1}, o nodo consegue operar por um tempo\footnote{O termo ``tempo'' não se refere ao tempo real, mas sim à uma expectativa decorrente da simulação.} de $1200~min$ ($20~horas$).
Já a \emph{Situação 2}, com \emph{sleep mode} de $8~horas$, o tempo alcançado é de $1550~min$ ($25,833~horas$) de funcionamento.
Poder-se-ia pensar que o nodo deveria ter um tempo de vida de pelo menos $28~horas$, afinal,
na situação sem o \emph{sleep mode} seu tempo de vida foi de $20~horas$.
Porém, ao dormir por $8~horas$, o nodo ainda está consumindo energia, mesmo que seja uma carga bastante baixa ($5~mA$).
É possível visualizar esse fenômeno na Figura~\ref{fig:simulacao0} (Situação 2), onde a bateria do nodo recupera parte de sua capacidade e,
em determinado momento, chega a um limite onde não consegue mais se recuperar.
A partir desse ponto, é reiniciado o processo de descarga.


\begin{figure}[!ht]
	\centering
	\includegraphics[width=.63\textwidth]{images/simulacao1/simulation1(edited).pdf}
	\caption{Cenário 2: Nodo sem \emph{sleep mode} (Situação 1).\newline
	\hspace*{3.4cm}Com diferentes tempos em \emph{sleep mode} (Situação 2, 3 e 4).}
	\label{fig:simulacao1}
\end{figure}

% 2. Cenário 2: Nodo sem Efeito Recuperação X Nodo com Efeito Recuperação.
	% Situação 1: Um nodo sem Efeito Recuperação.
	% Situação 2: Um nodo com Efeito Recuperação (metade do tempo da tarefa principal).
	% Situação 3: Um nodo com Efeito Recuperação (tempo igual ao da tarefa principal).
	% Situação 4: Um nodo com Efeito Recuperação (dobro do tempo da tarefa princiapl).
\subsection{Cenário 2}		
No Cenário 2, utilizam-se diferentes tempos para o \emph{sleep mode}.
Na primeira situação, o nodo executa a tarefa principal $A$ sem que exista ``descanso'' para a bateria.
Na segunda situação, insere-se a tarefa $C$ com período em \emph{sleep mode} igual à metade do tempo de execução da tarefa $A$, isto é, $5~min$.
Na terceira situação, além da tarefa $A$, executa-se a tarefa $C$ pelo tempo de $10~min$.
Na quarta situação, o período da tarefa $C$ sobe para o dobro do tempo de execução da tarefa $A$, ou seja, $20~min$.
O nodo executa de forma cíclica, isto é, executa sua tarefa principal e, em seguida,
entra em \emph{sleep mode} pelo tempo determinado de acordo com a situação simulada.
O processo é reiniciado ao término do \emph{sleep mode}. A Figura~\ref{fig:simulacao1} demonstra a execução das situações citadas.


De acordo com a Figura~\ref{fig:simulacao1}, a execução com \emph{sleep mode} (\emph{Situações 2, 3 e 4}) aumenta os tempos de vida do nodo.
Na \emph{Situação 1}, sem \emph{sleep mode}, o tempo de vida da bateria é de $1200~min$ ($20~horas$). Na \emph{Situação 2}, que utiliza um ciclo de execução com as tarefa $A$ e $C$ (\emph{sleep mode} de $5~min$), o tempo de duração da bateria sobe para $1455~min$ ($24,250~horas$). Na \emph{Situação 3}, que executa as tarefas $A$ e $C$ (\emph{sleep mode} de $10~min$), o tempo de vida da bateria alcança $1680~min$ ($28~horas$). Por fim, na \emph{Situação 4}, que executa as tarefas $A$ e $C$ (\emph{sleep mode} de $20~min$), o tempo de vida da bateria alcança $2070~min$ ($34,5~horas$).

\begin{table}[ht]
	\caption{Tempos obtidos no Cenário 2.}
	\label{tab:tempos-sim2}
	\centering
	\footnotesize{
	\begin{tabular}{p{1.5cm}p{2.5cm}p{2.0cm}p{2.2cm}}
		\toprule
		\textbf{Situação}	& \textbf{\emph{Sleep Mode}}	& \textbf{Tarefa(s)}	& \textbf{Tempo (min)}	\\ \toprule
		1			& Não				& $A$			& $1200$ ($20,00~h$)	\\
		2			& Sim ($5~min$)			& $AC$			& $1455$ ($24,25~h$)	\\
		3			& Sim ($10~min$)		& $AC$			& $1680$ ($28,00~h$)	\\
		4			& Sim ($20~min$)		& $AC$			& $2070$ ($34,50~h$)	\\ \bottomrule
	\end{tabular}
	}
\end{table}

A Tabela~\ref{tab:tempos-sim2} resume os resultados encontrados na simulação.
Neste cenário, percebe-se claramente que, ao inserir períodos ociosos na realização das tarefas do nodo,
ocorre um aumento significativo no tempo de vida da sua bateria graças ao Efeito Recuperação.
Comparando as Situações 1 e 3 deste cenário, o aumento no tempo de vida da bateria do nodo é de $40\%$.
No caso da Situação 3, o tempo em \emph{sleep mode} é igual ao tempo de execução da tarefa $A$.
Ao comparar as Situações 1 e 4, onde o \emph{sleep mode} equivale ao dobro do tempo de execução da tarefa $A$,
o aumento no tempo de vida da bateria sobe para $72,5\%$.



% 3. Cenário 3: Nodos sem Efeito Recuperação X Nodos com Efeito Recuperação (ordem das cargas).
	% Situação 1: Carga mais pesada primeiro (Sem sleep mode).
	% Situação 2: Sleep mode no meio das cargas.
	% Situação 3: Sleep mode no fim das cargas.
	
	% Situação 4: Carga mais pesada por último (Sem sleep mode).
	% Situação 5: Sleep mode no meio das cargas.
	% Situação 6: Sleep mode no fim das cargas.
\subsection{Cenário 3}
No Cenário 3, acrescenta-se outra tarefa ($B$).
O objetivo é verificar a influência da ordem de execução das tarefas para o Efeito Recuperação e, consequentemente,
para o tempo de vida da bateria.
O nodo executa o conjunto de tarefas mostrado na Tabela~\ref{tab:cargas} em uma determinada ordem e de forma cíclica.
São consideradas seis situações.
		
% \begin{figure}[ht]
% 	\centering
% 	\includegraphics[width=.60\textwidth]{images/simulacao2/situacao123(edited).pdf}
% 	\caption{Cenário 3. (Situação 1) Nodos sem \emph{sleep mode}. (Situação 2 e 3) Nodo com \emph{sleep mode}.}
% 	\label{fig:simulacao3}
% \end{figure}
% 
% A Figura~\ref{fig:simulacao3} mostra graficamente o comportamento das Situações 1, 2 e 3. As Situações 4, 5 e 6 foram omitidas uma vez que apresentam resultados semelhantes. De acordo com tal figura, tanto na Situação 2 quanto na Situação 3 é possível observar o período em \emph{sleep mode} na execução das tarefas pelo nodo. Por exemplo, na Situação 2 o \emph{sleep mode} é representado pela ``barra'' central, de acordo com a ordem de execução $ACB$. Neste caso, percebe-se que o após o intervalo de descanso da bateria existe uma recuperação na capacidade da bateria, representado pelo nível da carga no início da tarefa $B$.

\begin{table}[ht]
	\caption{Tempos obtidos no Cenário 3.}
	\label{tab:tempos-sim3}
	\centering
	\footnotesize{
	\begin{tabular}{p{1.5cm}p{2.0cm}p{2.0cm}p{2.2cm}}
		\toprule
		\textbf{Situação}	& \textbf{\emph{Sleep Mode}}	& \textbf{Ordenação}	& \textbf{Tempo (min)}	\\ \toprule
		1			& Não				& \{AB\}		& $555$ ($09,25~h$)	\\
		2			& Sim ($10~min$)		& \{ACB\}		& $725$ ($12,08~h$)	\\
		3			& Sim ($10~min$)		& \{ABC\}		& $750$ ($12,50~h$)	\\
		4			& Não				& \{BA\}		& $570$ ($09,50~h$)	\\
		5			& Sim ($10~min$)		& \{BCA\}		& $750$ ($12,50~h$)	\\
		6			& Sim ($10~min$)		& \{BAC\}		& $750$ ($12,50~h$)	\\ \bottomrule
	\end{tabular}
	}
\end{table}

Na Situação 1, o período em \emph{sleep mode} não é considerado, sendo admitida a ordem de execução $AB$.
Para a Situação 2, o período em \emph{sleep mode} é acrescentado entre as tarefas principais, com ordem de excução $ACB$.
Na Situação 3, o período em \emph{sleep mode} é deslocado para o fim do ciclo, sendo sua ordem: $ABC$.
Na Situação 4, retira-se a tarefa $C$ e a tarefa $B$ é deslocada para o começo do ciclo.
Neste caso, a ordem de execução é $BA$.
A Situação 5 passa a considerar o \emph{sleep mode}, com ordem de execução $BCA$.
Por fim, na Situação 6 o período em \emph{sleep mode} é deslocado para o fim do ciclo, com ordem de execução $BAC$.

Os tempos de execução podem ser observados na Tabela~\ref{tab:tempos-sim3}.
É possível notar que a ordem de execução das tarefas pode influenciar o tempo de vida da bateria do nodo.
Mais especificamente, nas Situações 2 e 3 existe uma pequena diferença nos tempos obtidos pela simulação.
Ao observar as Situações 1 e 4, também é possível perceber uma pequena diferença nos tempos obtidos,
sendo que nestes casos não são considerados os períodos em \emph{sleep mode}.
			
% Para efeito de comparação, em~\cite{schrickte:2013}, o autor realiza experimentos com nodos reais. De acordo com sua avaliação de consumo energético dos nodos, as correntes médias para um nodo ocioso, transmitindo e recebendo são, respectivamente: $10~mA$, $22~mA$ e $21~mA$. O autor considera tais valores condizentes com a especificação do microcontrolador utilizado e aponta que, caso uma bateria de $1050~mAh$ Li-ion fosse utilizada, o nodo teria um tempo de vida de aproximadamente $48~horas$. Neste caso não existe preocupação em utilizar o Efeito Recuperação da bateria, apontando valores em acordo com os alcançados através de simulações nesse trabalho.

\subsection{Cenário 4}
% 4. Cenário 4: Nodos sem Efeito Recuperação X Nodos com Efeito Recuperação (dois nodos).
  % Situação 1: 2 nodos executando (Sem sleep mode).
  % Situação 2: 2 nodos executando (Cem sleep mode).
No Cenário 4, dois nodos são utilizados para verificar a diferença nos tempos de vida de suas baterias com e sem o Efeito Recuperação.
Os nodos têm baterias com a mesma capacidade teórica.
São consideradas duas situações com diferentes formas de escalonamento.

\begin{figure}[ht]
	\centering
	\includegraphics[width=.65\textwidth]{images/simulation3.pdf}
	\caption{Escalonamentos utilizados no Cenário 4.}
	\label{fig:esquema-simulacao4}
\end{figure}
	
Na Situação 1, cada nodo executa a tarefa $A$ de forma simultânea, sem haver períodos em \emph{sleep mode}.
Na Situação 2 adota-se um revezamento entre os nodos:
enquanto um nodo executa a tarefa $A$, o outro nodo entra em \emph{sleep mode} (execução da tarefa $C$ pelo mesmo tempo da tarefa $A$, isto é, $10~min$), valendo-se do Efeito Recuperação da bateria.
Esse ciclo é repetido até que o nível mínimo de bateria (\emph{cutoff}) em ambos os nodos seja atingido.
A Figura~\ref{fig:esquema-simulacao4} mostra um esquema que resume o modo de execução em cada uma das situações descritas anteriormente.
	
\begin{figure}[ht]
	\centering
	\includegraphics[width=.60\textwidth]{images/simulacao3/situacao*(edited).pdf}
	\caption{Cenário 4: Nodos sem \emph{sleep mode} (Situação 1).\newline
	\hspace*{3.4cm}Nodos intercalados com \emph{sleep mode} (Situação 2).\newline
	\hspace*{3.4cm}Nodos intercalados com \emph{sleep mode} mas\newline
	\hspace*{6.75cm}sem Efeito Recuperação (Situação '$*$').}
	\label{fig:simulacao4}
\end{figure}

Na Figura~\ref{fig:simulacao4} é ilustrada a execução das situações 1 e 2, além de uma situação denominada de \emph{'$*$'}.
A \emph{Situação '$*$'} é equivalente à Situação 2, porém, representa o comportamento de um modelo de bateria que
não leva em conta o Efeito Recuperação.
Basicamente, ao invés do nodo recuperar a capacidade da bateria no período ocioso, ele mantém a mesma capacidade da execução
anterior para a próxima tarefa.
Essa situação é usada na figura para contrastar com a Situação 2 e mostrar o Efeito Recuperação e o tempo adicional
que esse efeito acrescenta no tempo de vida da bateria.

%Ao utilizar um valor muito pequeno de $k$, por exemplo $k = 10^{-8}$, limita-se a bateria do nodo somente ao tubo Carga Limite. Com uma dificuldade muito grande de transferência de carga entre os tubos ($k$ muito pequeno), considera-se a inexistência do tubo Carga Limite.

A bateria na Situação '$*$' alcança um tempo de vida de $1382,3~min$ ($23,03~horas$).
Esse valor pode ser obtido de forma aproximada através de um simples cálculo.
O tubo Carga Disponível tem capacidade de $625~mAh$ (ou $2250~As$) e a carga executada é de $40~mA$.
A razão entre esses valores ($625~mAh/40~mA$) resulta em $15,625~horas$, que equivale ao tempo total
caso o nodo executasse continuamente.
No entanto, como a situação específica adota uma execução intercalada, é preciso levar em consideração os tempos em que o nodo não executa.
Em $1~hora$ o nodo tem três períodos ociosos (neste caso, não há recuperação da bateria).
Por conseguinte, em $15,625~horas$, o nodo tem $46,875$ períodos ociosos.
Como cada período ocioso tem duração de $10~min$, multiplica-se a quantidade de períodos ociosos; o resultado é $468,75~min$ ($7,81~horas$).
Finalmente, $(15,625 + 7,81) = 23,4~horas$.

De acordo com a Figura~\ref{fig:simulacao4}, observa-se que a Situação 2 aumenta o tempo de vida da rede.
No caso da Situação 1, a execução simultânea dos nodos atinge um tempo de $1202~min$ ($20,03~horas$).
Nesta situação, o gráfico mostra as execuções sobrepostas dos dois nodos, uma vez que as cargas das baterias no início da
simulação são iguais e a execução não conta com \emph{sleep modes}.
Já na Situação 2, quando a execução adota o revezamento na coleta de dados, a simulação atinge um tempo de $1662,76~min$ ($27,71~horas$).
Isso significa um aumento de $38,33\%$ no tempo de vida da rede.
O gráfico dessa situação mostra que, enquanto um nodo está executando, o outro está em \emph{sleep mode},
recuperando capacidade em sua bateria no período disponível.

Como visto nos resultados simulados, adotar um sequenciamento (escalonamento de tarefas) inapropriado (sem utilizar o \emph{sleep mode},
por exemplo) pode drenar a bateria de forma mais rápida. Assim, na medida do possível, deve-se incorporar períodos ociosos entre as tarefas. Isso permite que a bateria recomponha parte de sua capacidade, garantindo maior tempo de vida para o nodo.

%************************************************
%************************************************
\balance
\section{Conclusão} \label{sec:conclusao}

O consumo energético dos nodos de uma \ac{RSSF} é um dos problemas mais pesquisados,
devido à necessidade de se manter esse tipo de rede ``viva'' o maior tempo possível.
Através da busca por métodos eficientes de economia de energia nos nodos é possível estender o tempo de vida de suas baterias,
aumentando o período ativo da rede como um todo.
Prever o período que ainda resta para um nodo se manter ativo, dependendo da carga de corrente aplicada em qualquer momento,
facilita o emprego de técnicas de escalonamento de sono, as quais estendem o tempo de vida da rede,
através do Efeito Recuperação.

O Cenário 4  mostra um caso simples, com apenas dois nodos.
Porém, é possível generalizar esse cenário para representar uma \ac{RSSF} contendo $n$ nodos, sendo que apenas uma fração
desses nodos precisam estar ativos simultaneamente para monitorar o ambiente.
Neste caso, poder-se-ia escolher os nodos que tenham maior capacidade em suas baterias para realizar as
leituras nos sensores e enviar tais dados para a estação base.
Enquanto isso, os outros nodos poderiam recuperar parte da capacidade em suas respectivas baterias.
Com isso, acredita-se que o Efeito Recuperação faria grande diferença no tempo de vida da rede.

Como trabalhos futuros, novas simulações podem ser realizadas, incluindo mais nodos.
Pretende-se integrar a presente modelagem em um ambiente voltado para simulação de \ac{RSSF},
como o OMNeT++~\cite{omnet:2014}.
Esta ferramenta conta com um modelo simples de bateria (linear), não representando de forma apropriada
os efeitos discutidos neste trabalho.

\noindent \textbf{Agradecimentos:} Os autores agradecem a CAPES e FCT pelo apoio a este trabalho.

\bibliographystyle{sbc}
\bibliography{2014WoccesLeonardo}

\end{document}