\documentclass[12pt]{article}
\usepackage{sbc-template}

\usepackage[latin1]{inputenc}
\usepackage[brazil]{babel}
\usepackage{graphicx,url}
\usepackage{listings,acronym}
\usepackage{amssymb,amsmath,amsfonts}
\usepackage{ctable,tabularx}
\usepackage{paralist,enumerate}
\usepackage{balance}
\usepackage[portuguese,ruled,lined,linesnumbered]{algorithm2e}
%\usepackage{algorithmic,algorithm}

	\newacro{FD}[FD]{Fusão de Dados}
	\newacro{STR}[STR]{Sistema de Tempo Real}
	\newacro{RSSF}[RSSF]{Rede de Sensores sem Fio}
	\newacroplural{RSSF}[RSSFs]{Redes de Sensores sem Fio}
	\newacro{WSN}[WSN]{Wireless Sensor Network}
	\newacroplural{WSN}[WSNs]{Wireless Sensor Networks}
	\newacro{KiBaM}[KiBaM]{Kinect Battery Model}

\sloppy

\title{Escalonamento de Sono e Efeito Recuperação em Baterias de Nodos em Redes de Sensores sem Fio}

\author{Leonardo M. Rodrigues\inst{1}, Carlos B. Montez\inst{1}}

\address{
	Programa de Pós-Graduação em Engenharia de Automação e Sistemas (PPGEAS)\\
	Universidade Federal de Santa Catarina (UFSC)\\
	Caixa Postal 476 -- CEP 88040-900 -- Florianópolis, SC -- Brasil
	\email{l.m.rodrigues@posgrad.ufsc.br, carlos.montez@ufsc.br}
}

\begin{document}
	\maketitle


	\begin{abstract}
		We present a study on the energy issue in \ac{WSN} nodes. Thus, we cover basics about batteries, battery models and the importance of task scheduling in the nodes. Simulations are used to show the importance of the recovery effect, intrinsic in batteries, to increase the lifetime of the network. Finally, we evaluate the results achieved in the simulations.
	\end{abstract}

	\begin{resumo} 
		Apresenta-se um estudo sobre a questão energética nos nodos de uma \acp{RSSF}. Assim, são abordados conceitos básicos sobre baterias, alguns modelos de bateria e a importância do escalonamento de tarefas nos nodos. Utilizam-se simulações para demonstrar a importância do Efeito Recuperação, intrínseco nas baterias, para aumentar o tempo de vida da rede. Por fim, avaliam-se os resultados atingidos nas simulações.
	\end{resumo}

	% Organização do artigo:
	% 1 - Introdução.
	% 2 - Embasamento Teórico:
	%	2.1 - Conceitos sobre Baterias.
	%	2.2 - Modelos de bateria.
	%	2.3 - Técnicas de Escalonamento.
	% 3 - Modelo e Algoritmos.
	% 4 - Simulações e Resultados.
	% 5 - Conclusão.



	\section{Introdução} \label{sec:introducao}
		% [ v ] Apresentar o tema RSSF.
		% [ v ] Comentar a importância da economia de energia nos nodos.
		% [ v ] Comentar sobre o tradeoff entre desempenho e tempo de vida.
		% 		Apresentar tópicos:
		% [ v ] - Modelos de Bateria: citar a existência de dois modelos analíticos.
		% [ v ] - Técnicas de escalonamento: citar sua importância no tempo de vida da bateria.
		% [ v ] - Fusão de Dados: citar importância sobre a não sobrecarga da rede (troca de mensagens).
		% [ v ] Indicar particionamento das seções do artigo.
		
		Uma \ac{RSSF} pode ser composta por até milhares de nodos com sensores dos mais diversos tipos, como: temperatura, umidade, pressão, etc. O tipo de rede e os sensores presentes nos nodos dependem da aplicação em questão. O objetivo principal é ``sentir'' o ambiente de forma contínua e tomar decisões com base nas informações coletadas. As atuais \acp{RSSF} servem como tema de investigação para diversos pesquisadores~\cite{akyildiz2:2002, aqeel:2011, li:2013}. O projeto de uma \ac{RSSF} envolve o desenvolvimento de diversas partes e, dentre as principais, pode-se citar o consumo de energia nos nodos~\cite{akkaya:2005}.
		
		Atualmente, os dispositivos móveis são muito comuns no cotidiano das pessoas. Como exemplo, pode-se citar: \emph{laptops}, \emph{tablets}, \emph{smartphones}, etc. Nestes casos, um importante requisito diz respeito à autonomia da bateria.	Em uma \ac{RSSF} isso não é diferente e a grande questão é: ``como obter do nodo um desempenho satisfatório e que, ao mesmo tempo, não sacrifique tanto o tempo de vida\footnote{Período funcional da bateria. Ao atingir um determinado nível, conhecido como \emph{cutoff}, as reações eletroquímicas da bateria deixam de acontecer, indicando que a mesma está descarregada.} da bateria?''.
		
		Os nodos da rede precisam estabelecer uma política adequada com relação à sua participação no compartilhamento de informações para não drenar a carga da bateria de forma ineficaz. Com isso, durante a fase de projeto de uma \ac{RSSF}, é importante observar a relação entre desempenho do nodo e o seu tempo de vida para que, ao passo que seja possível contribuir com a rede, a bateria consiga durar o maior tempo possível.
		
		Neste contexto, pesquisas apontam soluções para estimar o tempo de vida de baterias sob diversos tipos de cargas e escalonamentos de tarefas~\cite{nguyen:2011, rakhmatov:2002, kerasiotis:2010, panigrahi:2001}. Mais especificamente, \cite{jongerden:2008} cita a existência de dois modelos analíticos para esse fim, justificando sua utilização pelo fato de tais modelos levarem em conta os efeitos inerentes às baterias, como o Efeito Recuperação e o Efeito da Taxa de Capacidade. Tais conceitos são melhores explicados no decorrer deste artigo.
		
		Para se valer do Efeito Recuperação, bem como minimizar o Efeito da Taxa de Capacidade, é necessário escolher uma forma adequada de escalonamento das tarefas nos nodos, principalmente as que envolvem a utilização do módulo de transmissão/recepção de dados sem fios. Estudos apontam a existência de diferenças nos tempos de vida das baterias apenas em ``escolher'' de forma apropriada a ordem de execução das tarefas~\cite{li:2013, rakhmatov:2002}. Com isso, é possível maximizar o tempo de vida da bateria do nodo, aumentando, consequentemente, o tempo de vida da rede.

		Este artigo está organizado da seguinte forma. A Seção~\ref{sec:embasamento} trata sobre os conceitos básicos envolvidos neste trabalho. A Seção~\ref{sec:algoritmos} mostra algumas definições com relação ao modelo utilizado. A Seção~\ref{sec:simulacoes} apresenta as simulações realizadas, bem como alguns resultados preliminares obtidos neste trabalho. Na Seção~\ref{sec:conclusao}, apresentam-se as considerações finais sobre os assuntos discutidos neste artigo.



	\section{Embasamento Teórico} \label{sec:embasamento}
	Esta seção tem como objetivo abordar alguns conceitos importantes que estão diretamente ligados ao conteúdo deste artigo. Inicialmente, abordam-se as questões básicas sobre baterias, tal como funcionamento e características físicas. Em seguida, são vistos os conceitos sobre modelos de baterias conhecidos na literatura. Por fim, é feita uma revisão sobre escalonamento de tarefas em nodos.


	\subsection{Conceitos sobre Baterias} \label{ssec:baterias}
	% [ v ] Principais tecnologias.
	% [ v ] Como funciona quimicamente o descarregamento.
	% [ v ] Comentar sobre tipos de Modelos de Bateria.
	% [ v ] Influência do tipo descarga: Rate Capacity e Recovery Effect.	
	Atualmente, as baterias são componentes fundamentais em diversos setores. Sem as baterias, o conceito de mobilidade não existiria e qualquer dispositivo necessitaria de um fio conectado à tomada para funcionar. Basicamente, baterias são dispositivos que contêm uma ou mais células eletroquímicas capazes de transformar energia química em energia elétrica. As células são formadas por dois terminais (eletrodos): o positivo (ou \emph{cátodo}) e o negativo (ou \emph{ânodo}). Um eletrólito permite o fluxo de íons entre os terminais da bateria.
	
	\begin{figure}[ht]
		\centering
		\includegraphics[width=.4\textwidth]{images/battery.pdf}
		\caption{Modo de funcionamento de uma bateria.}
		\label{fig:battery}
	\end{figure}
	
	De forma geral, ao descarregar uma bateria, ocorre a oxidação do ânodo, gerando elétrons (que fluem pelo circuito externo) e íons carregados positivamente (que, por difusão, movem-se pelo eletrólito em direção ao cátodo). Reações de redução ocorrem no cátodo, gerando íons carregados negativamente. A Figura~\ref{fig:battery} ilustra o funcionamento de uma bateria simples.
	
	Além disso, cada bateria tem duas características próprias: $V_{OC}$ e $V_{cut}$. $V_{OC}$ é a voltagem em circuito aberto, ou seja, a carga total armazenada na bateria sem a presença de nenhuma corrente de descarga. $V_{cut}$ é o limite que indica quando a bateria está descarregada. Outro fator importante diz respeito à \emph{Capacidade Teórica}, que especifica qual a quantidade de carga máxima que uma bateria suporta. De forma semelhante, existe a \emph{Capacidade Atual}, que estabelece a quantidade de energia que uma bateria entrega sob uma determinada carga~\cite{lahiri:2002}.
	
	Existem diversos tipos de tecnologias de baterias recarregáveis: Ni-Cd (Níquel-Cádmio), Ni-MH (Níquel-Hidreto Metálico), Li-ion (Íons de Lítio), Li-polymer (Lítio-polímero). A tecnologia \textbf{Ni-Cd} foi amplamente utilizada em diversos dispositivos eletrônicos (celulares e \emph{laptops}, principalmente) devido ao seu baixo custo, entretanto, perdeu espaço devido à baixa capacidade de carga e ao ``efeito memória\footnote{Diminuição da capacidade de carga com o passar do tempo.}''. A tecnologia \textbf{Ni-MH} tem densidade de energia duas vezes maior que a tecnologia Ni-Cd, porém, tem menor ciclo de vida, é mais cara e ineficiente com altas taxas de descarga. A bateria \textbf{Li-ion} é uma das mais utilizadas na atualidade, contando com maior densidade de energia e ciclo de vida cerca de duas vezes maior que as baterias Ni-MH. Por outro lado, tem maior sensibilidade à correntes de descarga e é mais cara que a tecnologia Ni-MH. Por fim, as baterias \textbf{Li-polymer} são tão eficientes quanto a tecnologia Li-ion e ainda possuem um invólucro flexível, adequando-se aos dispositivos móveis com tamanho e peso reduzidos~\cite{lahiri:2002}.
	
	\subsubsection{Efeitos intrínsecos} \label{sssec:efeitos}
	Existem dois efeitos que estão presentes em qualquer bateria, independentemente da tecnologia utilizada: Efeito da Taxa de Capacidade (\emph{Rate Capacity Effect}) e Efeito Recuperação (\emph{Recovery Effect}). Tais efeitos são muito importantes para o tempo de vida e a capacidade de uma bateria, não podendo ser desprezados.
	
	\begin{itemize}
	\item \textbf{Efeito Taxa de Capacidade}: está relacionado à dependência entre a capacidade atual da bateria e a magnitude da corrente de descarga. Neste caso, ao aplicar altas correntes de descarga, a capacidade da bateria é significativamente reduzida.
	\item \textbf{Efeito Recuperação}: refere-se à habilidade que as baterias têm de recuperar parte de sua capacidade nos intervalos que deixa de receber cargas (correntes) externas. Dessa forma, indica-se que sejam inseridos períodos ociosos entre as cargas para que a bateria tenha um maior tempo de vida, como mostra~\cite{li:2013}.
	\end{itemize}


	\subsection{Modelos de Baterias} \label{ssec:modelos}
		% [ v ] Comentar sobre a importância da bateria em RSSF.
		% [ v ] Explicar o que são e para que servem os Modelos de Bateria.
		% [ v ] Comentar sobre tipos de Modelos de Bateria.
		% [ v ] Citar a existência de modelos analíticos e por que são melhores (consideram efeitos naturais da bateria).
		% [ v ] Mostrar equações e comentar sobre variáveis nelas encontradas.
		% [ v ] Mostrar um gráfico comparativo.
		As questões energéticas são de extrema importância no contexto das \acp{RSSF}, uma vez que o tempo de vida da rede depende das baterias individuais dos nodos que dela participam. É desejável que cada nodo maximize seu tempo de vida, podendo contribuir com a rede pelo maior período possível. Em um exemplo simples, onde um conjunto de nodos realiza o sensoriamento de uma determinada área, a morte\footnote{Momento que um nodo deixa de funcionar devido à falta de energia em sua bateria.} de um nodo pode enfraquecer a precisão dos dados coletados naquela área específica. Isso diminui a abrangência da rede em algumas regiões, tornando a captura de dados presente em apenas alguns locais e inexistente em outros.
		Dessa forma, o estudo com relação ao aumento no tempo de vida de baterias é contínuo, sendo importante a busca por novas tecnologias, algoritmos mais eficientes e modelos precisos para melhor aproveitar a capacidade oferecida.

		% Existem outros modelos conhecidos (ex.: Estocásticos), porém, não são revisados neste artigo.

		
		\subsubsection{Modelos de Bateria Analíticos} \label{sssec:analiticos}
		Os \emph{Modelos de Bateria Analíticos} são fundamentações matemáticas baseadas em equações que buscam considerar as características físicas das baterias. Tais modelos servem para estimar o tempo de vida das baterias, adequando-se à carga aplicada. Os modelos \emph{Analíticos} descrevem a bateria de forma abstrata, porém, suas propriedades são modeladas utilizando apenas algumas equações~\cite{jongerden:2008-2}.
		
		Tais modelos envolvem a avaliação de expressões analíticas, tornando-os computacionalmente flexíveis~\cite{schneider:2011}. Ou seja, é possível utilizar correntes como uma função de carga constante ou variável, ou alterar o tipo de bateria. Além disso, é importante que o modelo considere os efeitos eletroquímicos inerentes às baterias. Neste caso, ressalta-se o Efeito Recuperação e o Efeito da Taxa de Capacidade.
		
		O modelo mais simples é a \emph{Lei de Peukert}. Ele considera parte dos efeitos não lineares, relacionando o tempo de vida da bateria com a taxa de descarga. Porém, o Efeito Recuperação não faz parte do modelo. Assim, os resultados obtidos com a Lei de Peukert são considerados bons apenas para cargas contínuas constantes, sendo inadequado quando cargas variáveis ou interruptas são usadas~\cite{jongerden:2008-2}.
		
		Em~\cite{rakhmatov:2002-2}, os autores introduzem um novo modelo que descreve o processo de difusão do material ativo na bateria. Tal modelo permite estimar o tempo de vida da bateria, com uma boa aproximação, para uma dada corrente de descarga utilizando os dez primeiros termos da soma infinita.
		
		\begin{figure}[ht]
			\centering
			\includegraphics[width=.45\textwidth]{images/kibam-model.pdf}
			\caption{\ac{KiBaM}~\cite{manwell:1993}.}
			\label{fig:kibam-model}
		\end{figure}
		
		Outro modelo analítico é o \ac{KiBaM}~\cite{manwell:1993}. Este modelo abstrato é bastante intuitivo, sendo composto por dois tanques onde a carga da bateria é distribuída, conforme ilustra a Fig.~\ref{fig:kibam-model}.	O tanque \emph{Carga Disponível} fornece energia ao dispositivo ligado diretamente à bateria. Já o tanque \emph{Carga Limite} fornece carga ao tanque Carga Disponível. Entretanto, a taxa a qual ocorre a transferência de carga depende da diferença entre as alturas das cargas nos dois tanques ($h_1$ e $h_2$), além do parâmetro $k$. O parâmetro $c$ indica uma fração da carga total (inserida no tanque Carga Disponível) encontrada na bateria~\cite{jongerden:2008-2}.
		
		Ao receber uma carga $I$, a bateria reduz a carga disponível, aumentando a diferença entre as alturas nos dois tanques. Caso a carga seja removida, inicia-se o fluxo de carga entre o tanque Carga Limite e Carga Disponível até que a altura $h_1$ seja novamente igual à altura $h_2$. Dessa forma, durante um período ocioso, a bateria pode aumentar sua capacidade e, consequentemente, manter-se ativa por mais tempo.
		
		A troca de cargas entre os tubos é dada pelo sistema de equações diferenciais mostrado na Equação~\ref{eq:kibam-diferencial-equation}.
		\small
		\begin{equation}
			\begin{cases}
				\frac{di}{dt} = - I + k(h_2 - h_1), \\
				\frac{dj}{dt} = - k(h_2 - h_1),
			\end{cases}
			\label{eq:kibam-diferencial-equation}
		\end{equation}
		\normalsize
		tendo como condições iniciais: $i(0) = c \cdot C$ e $j(0) = (1 - c) \cdot C$, onde $C$ representa a capacidade total da bateria. Além disso, $h_1 = i/c$ e $h_2 = j/(1 - c)$. Tal sistema de equações pode ser resolvido utilizando transformadas de Laplace~\cite{jongerden:2008}.	A Equação~\ref{eq:kibam-equation} mostra como calcular a quantidade de carga nos dois tanques.

		\small
		\begin{equation}
			\begin{cases}
				i = i_0e^{-k't} + \frac{(y_0k'c-I)(1-e^{-k't})}{k'} - \frac{Ic(k't-1+e^{-k't})}{k'} \\
				j = j_0e^{-k't} + y_0(1-c)(1-e^{-k't}) - \frac{I(1-c)(k't-1+e^{-k't})}{k'},
			\end{cases}
			\label{eq:kibam-equation}
		\end{equation}
		\normalsize
		onde $k'$ é definido como:
		\small
		\begin{equation*}
			k' = \frac{k}{c(1-c)},
		\end{equation*}
		\normalsize
		sendo $i_0$ e $j_0$, respectivamente, as quantidades de Carga Disponível e Limite nos tanques, no tempo $t=0$. Para $y_0$ (Carga total), tem-se: $y_0 = i_0 + j_0$. O \ac{KiBaM} foi desenvolvido para modelar baterias Ácido-Chumbo. Segundo~\cite{jongerden:2008-2}, tal modelo não é adequado para baterias modernas utilizadas em dispositivos móveis, como as baterias Li-ion. Por outro lado, se o interesse recai apenas no tempo de vida da bateria, o \ac{KiBaM} pode ser utilizado, uma vez que descreve adequadamente tanto o Efeito da Taxa de Capacidade quanto o Efeito Recuperação.

		
	\subsubsection{Modelos de Bateria Estocásticos} \label{sssec:estocasticos}
		Segundo~\cite{jongerden:2008-2}, os primeiros modelos de bateria estocásticos foram desenvolvidos por Chiasserini e Rao, entre 1999 e 2001. Tais modelos são baseados em Cadeias de Markov com Tempo Discreto e produzem uma boa descrição qualitativa do comportamento da bateria sob pulsos de descarga. Entretanto, o modelo proposto por Chiasserini considera apenas o Efeito Recuperação, não conseguindo lidar com perfis de carga arbitrários com descargas de corrente variável (Efeito da Taxa de Capacidade).
		
		Em 2005, \cite{rao:2005} propôs um modelo de bateria, também utilizando Cadeias de Markov, baseado no modelo analítico \ac{KiBaM}\footnote{O \ac{KiBaM} original utiliza formulações para baterias Ácido-Chumbo.}~\cite{manwell:1993}. No entanto, a formulação foi alterada para baterias Ni-MH, comumente utilizadas em nodos de uma \ac{RSSF}. Os resultados experimentais deste modelo indicam que o tempo de vida da bateria de Ni-MH depende da frequência da carga aplicada, o que não ocorre no \ac{KiBaM} original (para escalas de tempo menores que 30 minutos). A solução envolve fazer com que a probabilidade de recuperar capacidade durante períodos ociosos dependa do tamanho do período~\cite{jongerden:2008-2}.
		

	\subsection{Técnicas de Escalonamento} \label{sssec:escalonamento}
		% [ v ] Comentar que o escalonamento do sono ajuda no tempo de vida.
		% [ v ] Mostrar maneiras de escalonar as tarefas (conforme carga exigida).
		% [ v ] Comentar sobre a inserção de períodos ociosos entre tarefas.
		% [ v ] Mostrar gráfico com resultados de simulações.
		Assim como estimar o tempo de vida de uma bateria sob diferentes cargas é importante, escalonar de maneira adequada as tarefas\footnote{O termo \emph{tarefa} se refere a qualquer atividade que necessite de carga oriunda da bateria.} do nodo também afeta o tempo de vida da bateria. Neste sentido, escolher a ordem na qual as tarefas devem ser realizadas pode influenciar a taxa de descarga da bateria, agindo ineficientemente ou tirando proveito dos seus efeitos naturais, como o Efeito Recuperação e o Efeito da Taxa de Capacidade.
	
		Ao levar em conta o fato de que tarefas têm necessidades diferentes, torna-se evidente que cada uma precisa de uma certa quantitade de energia para ser executada. Ou seja, algumas tarefas consomem mais energia que outras, exigindo mais corrente ou levando mais tempo para concluir, por exemplo. O questionamento neste ponto diz respeito a como escalonar as tarefas de forma que o tempo de vida da bateria do nodo seja maximizado. As possíveis soluções para tal indagação são abordadas em alguns estudos~\cite{li:2013, nguyen:2011, rakhmatov:2002, panigrahi:2001}.
	
		Em~\cite{li:2013}, apresenta-se a formulação do problema através de um simples exemplo para transmissão de pacotes em aplicações de Tempo Real Brandas (ou \emph{Soft Real-Time}). Além disso,~\cite{li:2013} propõe um algoritmo de otimização local ciente de bateria que insere períodos ociosos entre tarefas adjacentes, tirando proveito do Efeito Recuperação. Com isso, o objetivo é minimizar o consumo de carga total do sistema.

		Escolher a ordem de execução das tarefas também pode influenciar o tempo de vida da bateria. Em~\cite{rakhmatov:2002}, apresenta-se um exemplo demonstrando o impacto do sequenciamento de tarefas para a bateria do nodo. Ou seja, o tempo de vida da bateria é maximizado quando há decrescimento nas cargas de corrente das tarefas.



	\section{Modelo e Algoritmo} \label{sec:algoritmos}
		% [ v ] Comentar sobre o modelo utilizado.
		% [ - ] Comentar sobre a linguagem de programação.
		% [ v ] Mostrar o pseudo-algoritmo do KiBaM.
		% [ - ] Mostrar o pseudo-algotirmo do que é realizado nas simulações.
		Esta seção apresenta o modelo de bateria utilizado nas simulações. Como visto na Seção~\ref{ssec:modelos}, existem diversos modelos de bateria, cada um com suas características. O objetivo deste trabalho é observar o aumento no tempo de vida de uma \ac{RSSF} quando o Efeito Recuperação faz parte da rotina dos nodos nesta rede. Além disso, deseja-se simular adequadamente o Efeito da Taxa de Capacidade quando diferentes cargas são aplicadas nas baterias dos nodos da rede.
		
		% Outro ponto que merece ser citado diz respeito ao modo como o modelo foi implementado. Por se tratar de uma linguagem de propósito geral, bem estabelecida e disponível em diversas plataformas, utiliza-se a \emph{Linguagem de Programação C}.
		
		Diante desses motivos, um dos modelos de bateria que se encaixa no perfil descrito é o \ac{KiBaM}. Tal modelo aborda com certa simplicidade e grande abstração os conceitos característicos de uma bateria através da Equação~\ref{eq:kibam-equation}. Utiliza-se uma função, denominada \emph{kibam}, que é chamada sempre que um nodo necessita executar uma tarefa (ou um conjunto de tarefas). O Algoritmo~\ref{alg:kibam} descreve de forma simplificada o funcionamento da função.
		
		\begin{algorithm}[ht]
			\footnotesize
			\caption{KiBaM Function}
			\label{alg:kibam}
			\Entrada{y0, i0, j0, I, timeInit, period}
			\Saida{y0}
		\Inicio{
			initializeConstantsAndVariables()\;
			\Enqto{t $\leq$ (timeInit + period)}{
				compute-i(y0, i0, j0, I, t)\; \label{alg:linhai}
				compute-j(y0, i0, j0, I, t)\; \label{alg:linhaj}
				saveOutput(i, j, t)\;
			}
			updateVariables();
		}
		\end{algorithm}
		
		De acordo com o Algoritmo~\ref{alg:kibam}, a função \ac{KiBaM} tem parâmetros relacionados ao nodo que lhe invoca. Com isso, é possível definir a capacidade atual da bateria do nodo, sua tarefa e seus períodos de funcionamento. Neste caso, $y0$ é a capacidade teórica da bateria, $i0$ é a quantidade de carga no tubo Carga Disponível, $j0$ é a quantidade de carga no tubo Carga Limite, $I$ é a corrente aplicada pela tarefa, $timeInit$ é o tempo de início da simulação e $period$ é o tempo de execução da tarefa.
		
		O núcleo dessa função está no cálculo do conteúdo dos tubos Carga disponível (i) e Carga Limite (j) (linhas~\ref{alg:linhai} e~\ref{alg:linhaj}, respectivamente). Para isso, utilizam-se as definições encontradas na Equação~\ref{eq:kibam-equation}. Por fim, o estado de cada tubo da bateria é salvo em um arquivo à parte para análises e geração de gráficos.



	\section{Simulações e Resultados} \label{sec:simulacoes}
		% [ v ] Explicar como funciona a simulação.
		% [ v ] Comentar sobre a simulação sem e com o efeito recuperação.
		% [ v ] Mostrar figuras e comentar sobre as 'curvas'.
		% [ v ] Avaliar resultados obtidos.
		% [ v ] Apresentar algumas comparações entre os dois modelos simulados.
		% [ v ] Comentar sobre ganho percentual no tempo de vida dos nodos (rede).
		
		% OBS.:
		% 1. Leva em conta que o nodo tem conhecimento da carga em sua bateria.
		Esta seção tem por objetivo apresentar as simulações realizadas e os resultados preliminares desta pesquisa. O objetivo das simulações é fazer que o nodo execute até que a carga em sua bateria seja esgotada (ou alcance um valor mínimo predeterminado, \emph{cutoff}). Para isso, considera-se que o nodo tem conhecimento da carga existente em sua bateria. O nodo é alimentado por uma bateria com capacidade teórica de $1000~mAh$ (ou $3600~As$) e conta com um conjunto de tarefas para executar, juntamente com seus respectivos tempos de execução.
		
		\begin{table}[ht]
			\caption{Cargas utilizadas nas simulações.}
			\label{tab:cargas}
			\centering
			\footnotesize{
			\begin{tabular}{p{1.5cm}p{2.0cm}p{3.8cm}}
				\toprule
				\textbf{Tarefa}	& \textbf{\emph{Carga (mA)}}	& \textbf{Tempo de execução (min)}	\\ \toprule
				$A$					& $40$						& $10$		\\
				$B$					& $20$						& $5$		\\
				$C$					& $5$						& $0-20$	\\ \bottomrule
			\end{tabular}
			}
		\end{table}
		
		O conjunto de tarefas utilizados em todas as simulações é descrito a seguir. A primeira carga, chamada de $A$, tem consumo de $40~mA$ e é executa por $10~min$. Ela equivale, por exemplo, ao processamento realizado em uma leitura de sensor junto com a transmissão de tal informação para outro nodo. A segunda carga, chamada de $B$, consome $20~mA$ e tem tempo de execução igual a $5~min$. Ela equivale, por exemplo, ao período que o rádio receptor fica ligado à espera de novas comunicações. Por fim, a terceira carga, chamada de $C$, consome $5~mA$ é executada por tempos variando entre $0-20~min$, de acordo com a simulação. Ela representa o período ocioso (\emph{sleep mode}) que o nodo tem para fazer valer o Efeito Recuperação em sua bateria. A Tabela~\ref{tab:cargas} apresenta as tarefas utilizadas de forma resumida.
		
		A função do \ac{KiBaM} é calcular a quantidade de carga gasta na bateria quando o nodo executa uma tarefa. Assim, a capacidade da bateria é reduzida conforme a carga (corrente) aplicada ao realizar uma tarefa (Efeito da Taxa de Capacidade). Caso o nodo entre no \emph{sleep mode}, o \ac{KiBaM} é responsável por modelar o ganho de capacidade na bateria do nodo (Efeito Recuperação). Os resultados das simulações são mostrados em gráficos que descrevem a descarga no tubo Carga Disponível do nodo.
		
		% 2. Simulação 1: Nodos sem Efeito Recuperação X Nodo com Efeito Recuperação.
			% Situação 1: Nodo sem Efeito Recuperação.
			% Situação 2: Nodo com Efeito Recuperação em determinado intervalo.
		\begin{figure}[ht]
			\centering
			\includegraphics[width=.65\textwidth]{images/simulacao0/simulation0(edited).pdf}
			\caption{Simulação 1. (Situação 1) Nodo sem \emph{sleep mode}. (Situação 2) Nodo com \emph{sleep mode} de 8~horas em determinado intervalo.}
			\label{fig:simulacao0}
		\end{figure}
		
		A Simulação 1 verifica a diferença nos tempos de execução quando o Efeito Recuperação é ou não utilizado. Com isso, consideram-se duas situações. A \emph{Situação 1} investiga o funcionamento do nodo sem utilizar o \emph{sleep mode} até que sua bateria alcance o nível de \emph{cutoff}. Neste caso, o nodo executa apenas a tarefa $A$. Na \emph{Situação 2}, o nodo opera normalmente (tal qual a \emph{Situação 1}) até o momento que entra em \emph{sleep mode}. Neste momento, o nodo passa a executar a tarefa $C$, tirando proveito do Efeito Recuperação por um determinado tempo ($8~horas$) e, então, retorna à atividade realizada anteriormente, isto é, execução da tarefa $A$.
		
		Na Figura~\ref{fig:simulacao0}, ao entrar em \emph{sleep mode} (\emph{Situação 2}), a bateria do nodo tem maior tempo de vida. Na \emph{Situação 1}, o nodo consegue operar por um tempo\footnote{O termo ``tempo'' não se refere ao tempo real, mas sim à uma expectativa decorrente da simulação.} de $1200~min$ ($20~horas$). Já a \emph{Situação 2}, com \emph{sleep mode} de $8~horas$, o tempo alcançado é de $1550~min$ ($25,833~horas$) de funcionamento. Poderia-se pensar que o nodo deveria ter um tempo de vida de pelo menos $28~horas$, afinal, na situação sem o \emph{sleep mode} seu tempo de vida foi de $20~horas$. Porém, ao dormir por $8~horas$, o nodo ainda está consumindo energia, mesmo que seja uma carga bastante baixa ($5~mA$). É possível visualizar esse fenômeno na Figura~\ref{fig:simulacao0} (Situação 2), onde a bateria do nodo recupera parte de sua capacidade e, em determinado momento, chega a um limite onde não consegue mais se recuperar. A partir desse ponto, é reiniciado o processo de descarga.
		
		% 2. Simulação 2: Nodo sem Efeito Recuperação X Nodo com Efeito Recuperação.
			% Situação 1: Um nodo sem Efeito Recuperação.
			% Situação 2: Um nodo com Efeito Recuperação (metade do tempo da tarefa principal).
			% Situação 3: Um nodo com Efeito Recuperação (tempo igual ao da tarefa principal).
			% Situação 4: Um nodo com Efeito Recuperação (dobro do tempo da tarefa princiapl).
		\begin{figure}[ht]
			\centering
			\includegraphics[width=.65\textwidth]{images/simulacao1/simulation1(edited).pdf}
			\caption{Simulação 2. (Situação 1) Nodo sem \emph{sleep mode}. (Situação 2, 3 e 4) Nodo com diferentes tempos em \emph{sleep mode}.}
			\label{fig:simulacao1}
		\end{figure}
		
		Na Simulação 2, utilizam-se diferentes tempos para o \emph{sleep mode}. Na primeira situação, o nodo executa a tarefa principal $A$ sem que exista ``descanso'' para a bateria. Na segunda situação, insere-se a tarefa $C$ com período em \emph{sleep mode} igual à metade do tempo de execução da tarefa $A$, isto é, $5~min$. Na terceira situação, além da tarefa $A$, executa-se a tarefa $C$ pelo tempo de $10~min$. Na quarta situação, o período da tarefa $C$ sobe para o dobro do tempo de execução da tarefa $A$, ou seja, $20~min$. O nodo executa de forma cíclica, isto é, executa sua tarefa principal e em seguida entra em \emph{sleep mode} pelo tempo determinado de acordo com a situação simulada. O processo é reiniciado ao término do \emph{sleep mode}. A Figura~\ref{fig:simulacao1} demonstra a execução das situações citadas.
		
		\begin{table}[ht]
			\caption{Tempos computados na Simulação 2.}
			\label{tab:tempos-sim2}
			\centering
			\footnotesize{
			\begin{tabular}{p{1.5cm}p{2.5cm}p{2.0cm}p{2.2cm}}
				\toprule
				\textbf{Situação}	& \textbf{\emph{Sleep Mode}}	& \textbf{Tarefa(s)}	& \textbf{Tempo (min)}	\\ \toprule
				1					& Não							& $A$					& $1200$ ($20,00~h$)	\\
				2					& Sim ($5~min$)					& $AC$					& $1455$ ($24,25~h$)	\\
				3					& Sim ($10~min$)				& $AC$					& $1680$ ($28,00~h$)	\\
				4					& Sim ($20~min$)				& $AC$					& $2070$ ($34,50~h$)	\\ \bottomrule
			\end{tabular}
			}
		\end{table}
		
		De acordo com a Figura~\ref{fig:simulacao1}, a execução com \emph{sleep mode} (\emph{Situações 2, 3 e 4}) aumenta os tempos de vida do nodo. Na \emph{Situação 1}, sem \emph{sleep mode}, o tempo de vida da bateria é de $1200~min$ ($20~horas$). Na \emph{Situação 2}, que utiliza um ciclo de execução com as tarefa $A$ e $C$ (\emph{sleep mode} de $5~min$), o tempo de duração da bateria sobe para $1455~min$ ($24,250~horas$). Na Situação 3, que executa as tarefas $A$ e $C$ (\emph{sleep mode} de $10~min$), o tempo de vida da bateria alcança $1680~min$ ($28~horas$). Por fim, na Situação 4, que executa as tarefas $A$ e $C$ (\emph{sleep mode} de $20~min$), o tempo de vida da bateria alcança $2070~min$ ($34,5~horas$). A Tabela~\ref{tab:tempos-sim2} resume os resultados encontrados na simulação.
		
		Nesta simulação, percebe-se claramente que, ao inserir períodos ociosos na realização das tarefas do nodo, ocorre um aumento significativo no tempo de vida da sua bateria graças ao Efeito Recuperação. Comparando as Situações 1 e 3 desta simulação, o aumento no tempo de vida da bateria do nodo é de $40\%$. No caso da Situação 3, o tempo em \emph{sleep mode} é igual ao tempo de execução da tarefa $A$. Ao comparar as Situações 1 e 4, onde o \emph{sleep mode} equivale ao dobro do tempo de execução da tarefa $A$, o aumento no tempo de vida da bateria sobe para $72,5\%$.
		
		% 3. Simulação 3: Nodos sem Efeito Recuperação X Nodos com Efeito Recuperação (ordem das cargas).
			% Situação 1: Carga mais pesada primeiro (Sem sleep mode).
			% Situação 2: Sleep mode no meio das cargas.
			% Situação 3: Sleep mode no fim das cargas.
			
			% Situação 4: Carga mais pesada por último (Sem sleep mode).
			% Situação 5: Sleep mode no meio das cargas.
			% Situação 6: Sleep mode no fim das cargas.
		Na Simulação 3, acrescenta-se outra tarefa ($B$). O objetivo é verificar a influência da ordem de execução das tarefas para o Efeito Recuperação e, consequentemente, para o tempo de vida da bateria. O nodo executa o conjunto tarefas mostrado na Tabela~\ref{tab:cargas} em uma determinada ordem e de forma cíclica. São consideradas seis situações.
		
		% A Figura~\ref{fig:simulacao3} mostra graficamente o comportamento das Situações 1, 2 e 3. As Situações 4, 5 e 6 foram omitidas uma vez que apresentam resultados semelhantes. De acordo com tal figura, tanto na Situação 2 quanto na Situação 3 é possível observar o período em \emph{sleep mode} na execução das tarefas pelo nodo. Por exemplo, na Situação 2 o \emph{sleep mode} é representado pela ``barra'' central, de acordo com a ordem de execução $ACB$. Neste caso, percebe-se que o após o intervalo de descanso da bateria existe uma recuperação na capacidade da bateria, representado pelo nível da carga no início da tarefa $B$.
		
		\begin{table}[t]
			\caption{Tempos computados na Simulação 3.}
			\label{tab:tempos-sim3}
			\centering
			\footnotesize{
			\begin{tabular}{p{1.5cm}p{2.0cm}p{2.0cm}p{2.2cm}}
				\toprule
				\textbf{Situação}	& \textbf{\emph{Sleep Mode}}	& \textbf{Ordenação}	& \textbf{Tempo (min)}	\\ \toprule
				1					& Não							& \{AB\}				& $555$ ($09,25~h$)	\\
				2					& Sim ($10~min$)				& \{ACB\}				& $725$ ($12,08~h$)	\\
				3					& Sim ($10~min$)				& \{ABC\}				& $750$ ($12,50~h$)	\\
				4					& Não							& \{BA\}				& $570$ ($09,50~h$)	\\
				5					& Sim ($10~min$)				& \{BCA\}				& $750$ ($12,50~h$)	\\
				6					& Sim ($10~min$)				& \{BAC\}				& $750$ ($12,50~h$)	\\ \bottomrule
			\end{tabular}
			}
		\end{table}
		
		Na Situação 1, o período em \emph{sleep mode} não é considerado, sendo admitida a ordem de execução $AB$. Para a Situação 2, o período em \emph{sleep mode} é acrescentado entre as tarefas principais, com ordem de excução $ACB$. Na Situação 3, o período em \emph{sleep mode} é deslocado para o fim do ciclo, sendo sua ordem: $ABC$. Na Situação 4, retira-se a tarefa $C$ e a tarefa $B$ é deslocada para o começo do ciclo. Neste caso, a ordem de execução é $BA$. A Situação 5 passa a considerar o \emph{sleep mode}, com ordem de execução $BCA$. Por fim, na Situação 6 o período em \emph{sleep mode} é deslocado para o fim do ciclo, com ordem de execução $BAC$. Os tempos de execução podem ser observados na Tabela~\ref{tab:tempos-sim3}.
		
		De acordo com a Tabela~\ref{tab:tempos-sim3}, é possível notar que a ordem de execução das tarefas pode influenciar o tempo de vida da bateria do nodo. Mais especificamente, nas Situações 2 e 3 existe uma pequena diferença nos tempos computados pela simulação. Ao observar as Situações 1 e 4, também é possível perceber uma pequena diferença nos tempos computados, sendo que nestes casos não são considerados os períodos em \emph{sleep mode}.
		
		% 4. Simulação 4: Nodos sem Efeito Recuperação X Nodos com Efeito Recuperação (dois nodos).
			% Situação 1: 2 nodos executando (Sem sleep mode).
			% Situação 2: 2 nodos executando (Cem sleep mode).
		\begin{figure}[ht]
			\centering
			\includegraphics[width=.65\textwidth]{images/simulation3.pdf}
			\caption{Esquema de execução utilizado na Simulação 4.}
			\label{fig:esquema-simulacao4}
		\end{figure}
		
		\begin{figure}[ht]
			\centering
			\includegraphics[width=.60\textwidth]{images/simulacao3/situacao(edited).pdf}
			\caption{Simulação 4. (Situação 1) Nodos sem \emph{sleep mode}. (Situação 2) Nodos com \emph{sleep mode}.}
			\label{fig:simulacao4}
		\end{figure}
		
		Na Simulação 4, dois nodos são utilizados para verificar a diferença nos tempos de vida de suas baterias quando o Efeito Recuperação é ou não levado em conta. Os nodos têm baterias com a mesma capacidade teórica. São consideradas duas situações. Na Situação 1, cada nodo executa a tarefa $A$ de forma simultânea, sem haver períodos em \emph{sleep mode}. A Situação 2 adota um revezamento sistemático entre os nodos. Nesse caso, enquanto um nodo executa a tarefa $A$, o outro nodo entra em \emph{sleep mode} (execução da tarefa $C$ pelo mesmo tempo da tarefa $A$, isto é, $10~min$), valendo-se do Efeito Recuperação da bateria. Esse ciclo é repetido até que o nível mínimo de bateria em ambos os nodos seja atingido (\emph{cutoff}). A Figura~\ref{fig:esquema-simulacao4} mostra um esquema que resume o modo de execução em cada uma das situações descritas anteriormente. Já a Figura~\ref{fig:simulacao4} demonstra a execução das situações citadas.
		
		De acordo com a Figura~\ref{fig:simulacao4}, a Situação 2 aumenta o tempo de vida da rede. No caso da Situação 1, a execução simultânea dos nodos atinge um tempo de $1202~min$ ($20,03~horas$). Já na Situação 2, quando a execução adota o revezamento na coleta de dados, a simulação atinge um tempo de $1662,76~min$ ($27,71~horas$). Isso significa um aumento de $38,33\%$ no tempo de vida da rede.

% Para efeito de comparação, em~\cite{schrickte:2013}, o autor realiza experimentos com nodos reais. De acordo com sua avaliação de consumo energético dos nodos, as correntes médias para um nodo ocioso, transmitindo e recebendo são, respectivamente: $10~mA$, $22~mA$ e $21~mA$. O autor considera tais valores condizentes com a especificação do microcontrolador utilizado e aponta que, caso uma bateria de $1050~mAh$ Li-ion fosse utilizada, o nodo teria um tempo de vida de aproximadamente $48~horas$. Neste caso não existe preocupação em utilizar o Efeito Recuperação da bateria, apontando valores em acordo com os alcançados através de simulações nesse trabalho.

	\balance
	\section{Conclusão} \label{sec:conclusao}
		O consumo energético dos nodos define o sucesso de uma \ac{RSSF}. Através da busca por métodos eficientes de economia de energia nos nodos é possível extender o tempo de vida de suas baterias, aumentando o período ativo da rede como um todo. Prever o período que ainda resta para um nodo se manter ativo, dependendo da carga de corrente aplicada em qualquer momento, torna a rede mais precisa. Além disso, os modelos auxiliam na correta caracterização das baterias através dos Efeitos da \emph{Taxa de Capacidade} e \emph{Recuperação}.
		
		Realizar o escalonamento (ou sequenciamento) correto das tarefas do nodo também influencia o tempo de vida de sua bateria. Como visto, adotar um sequenciamento inapropriado (sem utilizar o \emph{sleep mode}, por exemplo) pode drenar a bateria de forma mais rápida. Assim, na medida do possível, deve-se incorporar períodos ociosos entre as tarefas. Isso permite que a bateria recomponha parte de sua capacidade, garantindo maior tempo de vida para o nodo.
		
		Como trabalhos futuros, novas simulações devem ser realizadas, incluindo mais nodos. Além disso, pretende-se integrar tal modelagem em um ambiente voltado para simulação de \acp{RSSF}, como o OMNeT++~\cite{omnet:2014}. Esta ferramenta conta com um modelo simples de bateria (linear), não representando de forma apropriada os efeitos discutidos neste trabalho. Com isso, a utilização de um modelo mais preciso é relevante neste contexto.

	\nocite{ruzzelli:2010}


	\bibliographystyle{sbc}
	\bibliography{sbc-template}

\end{document}